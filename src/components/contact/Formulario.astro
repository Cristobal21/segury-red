---
import CopyEmailBTN from './CopyEmailBTN'
const action = '/send-email.php'

---

<div id="contacto" class="flex min-h-dvh items-center justify-center">
  <div
    class="flex w-full max-w-6xl flex-col overflow-hidden rounded-3xl bg-white shadow-xl md:flex-row"
  >
    <!-- Lado de botones flotantes -->
    <div
      class="flex justify-around gap-y-4 bg-gray-100 p-6 md:w-1/3 md:flex-col md:items-center md:justify-start md:space-y-6 md:py-12"
    >
      <a
        href="https://wa.me/56992760697?text=Hola%20quiero%20más%20información"
        target="_blank"
        class="flex w-full items-center justify-center rounded-xl bg-green-500 py-3 font-semibold text-white shadow-md transition-all duration-300 hover:bg-green-600"
      >
        WhatsApp
      </a>

      <CopyEmailBTN client:load />

    </div>

    <!-- Lado del formulario -->
    <div class="p-6 md:w-2/3 md:p-12">
      <h2 class="mb-6 text-center text-3xl font-bold text-gray-800 md:text-left">
        Envíanos un mensaje
      </h2>
      <form
        action={action}
        method="POST"
        class="space-y-4"
        id="contactForm"
      >
        <input
          type="text"
          name="name"
          placeholder="Tu nombre"
          class="w-full rounded-xl border border-gray-300 p-4 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          required
        />

        <input
          type="email"
          name="email"
          placeholder="Tu correo"
          class="w-full rounded-xl border border-gray-300 p-4 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          required
        />

        <!-- Honeypot -->
        <input type="text" name="company" tabindex="-1" autocomplete="off" class="hidden" aria-hidden="true" />

        <textarea
          name="message"
          rows="5"
          placeholder="Tu mensaje..."
          class="w-full rounded-xl border border-gray-300 p-4 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          required></textarea>

        <button
          type="submit"
          class="w-full rounded-xl bg-indigo-600 py-4 font-semibold text-white shadow-md transition-all duration-300 hover:bg-indigo-700"
        >
          Enviar mensaje
        </button>
      </form>
      <p id="formStatus" class="text-sm"></p>
    </div>
  </div>
</div>

<script type="module">

  const form = document.getElementById('contactForm');
  const statusEl = document.getElementById('formStatus');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    statusEl.textContent = 'Enviando...';
    try {
      const res = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: { 'Accept': 'application/json' },
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok || !data.ok) {
        statusEl.textContent = data.error || 'No se pudo enviar. Intenta nuevamente.';
        statusEl.className = 'text-sm text-red-600';
        return;
      }
      statusEl.textContent = '¡Gracias! Tu mensaje fue enviado.';
      statusEl.className = 'text-sm text-green-600';
      form.reset();
    } catch {
      statusEl.textContent = 'Error de red. Intenta nuevamente.';
      statusEl.className = 'text-sm text-red-600';
    }
  });
</script>


